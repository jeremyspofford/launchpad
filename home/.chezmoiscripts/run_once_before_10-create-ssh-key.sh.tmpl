#!/usr/bin/env bash

# Create SSH key if it doesn't exist
if [[ ! -f ~/.ssh/personal_id_ed25519 ]]; then
    mkdir -p ~/.ssh
    ssh-keygen -t ed25519 -C "{{ .email }}" -f ~/.ssh/personal_id_ed25519 -N ""
    
    # Start SSH agent and add key
    eval "$(ssh-agent -s)"
    ssh-add ~/.ssh/personal_id_ed25519

    echo "SSH key generated. Please add the following key to GitHub:"
    cat ~/.ssh/personal_id_ed25519.pub
    
    # Try to copy to clipboard
    if command -v pbcopy >/dev/null 2>&1; then
        cat ~/.ssh/personal_id_ed25519.pub | pbcopy
        echo "Key copied to clipboard (macOS)"
    elif command -v xclip >/dev/null 2>&1; then
        cat ~/.ssh/personal_id_ed25519.pub | xclip -selection clipboard
        echo "Key copied to clipboard (Linux)"
    elif command -v wl-copy >/dev/null 2>&1; then
        cat ~/.ssh/personal_id_ed25519.pub | wl-copy
        echo "Key copied to clipboard (Wayland)"
    fi
    
    echo "Press enter to continue after adding the key to GitHub..."
    read
fi